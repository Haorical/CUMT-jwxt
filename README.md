# 一种应用于中国矿业大学正方教务的信息采集与数据处理的作用于客户端与服务端的多协同高并发低代码的包含但不限于生成对抗与卷积神经网络的信息点对点应用与处理系统

## 免责声明
本代码仅用于学习，下载后请勿用于商业用途。

在使用本项目时造成对您自己或他人任何形式的损失和伤害，我们不承担任何责任。

如您在使用本项目的过程中存在任何非法行为，您需自行承担相应后果，我们将不承担任何法律及连带责任。 

在使用本工具前，请您务必审慎阅读、充分理解各条款内容，限制、免责条款或者其他涉及您重大权益的条款可能会以加粗、加下划线等形式提示您重点注意。 除非您已充分阅读、完全理解并接受本协议所有条款，否则，请您不要使用本项目。

您的使用行为或者您以其他任何明示或者默示方式表示接受本协议的，即视为您已阅读并同意本协议的约束。 

## 前言

**名字起的比较绕口，简而言之，爬虫🥰**

配置好后直接运行main.py就可以体验爬取成绩的功能，代码可读性良好，适合二次开发。

本着服务抗大学子的宗旨，写了这个教务爬虫，用来练手，应该会开发一段时间，目前
实现了模拟登录和爬取成绩与课表，抢课功能将不再开发，感兴趣的可以自己写。

## 功能

### 模拟登录接口实现

#### 简介
**模拟登录基于flask,并已经部署到了服务器上，并提供了相应接口供使用，该项目将不再开源，下面只提供实现思路。**

一共写了两个版本，一个是使用selenium的SlowLogin，看名字就看出来了，这个登录的慢
而且需要配置webdriver，登录一次大约需要8-10秒钟；另一个是基于requests的
FastLogin，这个顾名思义就相当的快了，登录一次不到五秒钟，速度飞起，而且可能我用的
vpn比较卡，在校园网上应该能更快。**当然服务器上的只有FastLogin!**

两个模拟登录都可以直接返回成功登录之后的cookie，可以用来爬之后的界面，非常适合二次开发，欢迎二次开发，最好给个star :)

#### 实现
先说SlowLogin，比较无脑，获得输入框的xpath，然后直接sendkeys，这里有个比较麻烦
的就是验证码的问题，这里我用了webdriver的screenshot方法，将图片保存到本地，然后调用
本地的ocr，而且存在识别错现象。因为本来就不是很智能，用人眼看填验证码的话
就更不智能了。

FastLogin这个就非常智能，模拟了发包过程，通过分析登录操作可以知道，先get RSA的公钥再get验证码，分析前端加密js可知，是通过rsa对password进行了加密，我们可以用简单的用python模拟，考虑到搭建环境太复杂，这里是模拟的，没有用exejs和node.js，因此耗费了很长时间，其中jsFunction模拟了js中对RSA的加密。由于get的验证码是二进制文件
我们可以直接将其写入文件中，然后调用本地AI识别，或者人工识别，两个函数在FastLogin中可以自由选择，可以通过config.yml进行设置(服务器端默认AI识别)

```python
# 智能人工识别验证码
code = get_code_by_people(sessions)
# 人工智能识别验证码
code = get_code_by_ocr(sessions)
```
config如下
```
opinions:
  - AI: true
```
调用人工识别函数的时候比较有趣，如下，会弹出窗口，然后人工识别

![](https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916224421.png)

可以看到成功获得了cookie

![](https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916224809.png)

ocr识别的话，如下

![](https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916225044.png)

可以看到，只识别了一次，如果识别错误的话，会自动重新登录，直到登录成功

### 爬取成绩

分析抓包即可，页面逻辑比较简单，post后返回的是json数据，解析，保存成了字典，{科目=>[平时分，期末分，总分，学分，绩点]}，因为获得平时分时需要每一科都请求一次，因此速度比较慢，其中也有一些选项，自己探索吧，懒得写了，睡觉！

![](https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916230422.png)

### 爬取课表

与爬取成绩类似，之后将进行图形化处理。

### 二次开发

最近突发奇想，改了一部分爬取成绩的逻辑，搭在了服务器上，配置了server酱，每一分钟爬一次成绩，然后有新成绩的时候自动发微信，实现起来也很简单。

## 设置
一些设置如下，需要保存在config.yml中，否则会报错，关于api的url和key，将在选课前夕公布
```yaml
api:
  - url: '' # 模拟登录接口
  - key: '' # 接口授权密钥
user:
  - id: 'xxxxxxxx' # 学号
  - password: 'xxxxxxxxxx' # 密码
```
